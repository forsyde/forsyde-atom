\documentclass{standalone}
\usepackage{forsyde-pc}
\usepackage{forsyde-math}
\begin{document}

\newsavebox\formula
\begin{lrbox}{\formula}
\begin{tikzpicture}[nomoccolor, type style = \scriptsize\texttt]
  \primitive[f=$pc$]{pm}{0,2}{$\fMapS$};
  \primitive[]      {pp}{0,0}{$\pipeS$};
  \vector[] (pm) -> (pp);
  
  \node[anchor=east] (s)  at ($(pp)-(2,0)$) {$\vect{s}$};
  \node[anchor=east] (vm) at ($(pm)-(2,-.5)$) {$\vect{v}^m$};
  \node[] (sn) at ($(s)!.5!(vm)$) {$\vect{s}^n$};

  \signal[] (s) -> (pp);
  \vector[] (s) -> (pm);
  \vectorn[] (sn) -> (pm);
  \vectorn[] (vm) -> (pm);
  \signal[] (pp) -> (2,0);
  \node[rotate=0, anchor=south] at ($(s)!.5!(pp)$) {$_{@1}$};
  \node[rotate=45, anchor=south] at ($(s)!.4!(pm)$) {$_{@\vect{2..}}$};
\end{tikzpicture}
\end{lrbox}

\newsavebox\network
\begin{lrbox}{\network}
\begin{tikzpicture}[nomoccolor, type style = \scriptsize\texttt]
  \foreach \i/\y in {1/4, 2/2.5, q/0} {
    \leafstd[type=pc, ni=3, nf=1, f1={$v^m$},inner sep=8pt] {p\i} {-\y,\y} {$p_\i$};
    \coordinate (s\i) at ($(p\i -p.i3)-(5,0)+(\y,0)$);
    \coordinate (s2\i) at ($(p\i -p.i2)-(5,0)+(\y,0)$);
    \coordinate (vs\i) at ($(p\i -p.i1)-(5.5,0)+(\y,0)$);
    \coordinate (vv\i) at ($(p\i -p.i1)-(6,-.4)+(\y,0)$);
    \signal[] (s\i) -> (p\i -p.i3);
    \signaln[] (vs\i) -> (p\i -p.i1);
    \function[-|] (vv\i) -> (p\i -f.i1); 
  }

  \vectorn[] (vv1) - (vvq);
  \vectorn[] (vs1) - (vsq);
  \vector[] (s21) - (sq);

  \signal[] (s21) -> (p1-p.i2);
  \signal[-|-] (p1-p.o1) -> (p2-p.i2);
  \signal[-|-] (p2-p.o1) -> ($(p2-p.o1)+(.5,-.7)$);
  \signal[-|-] ($(pq-p.i2)-(.7,-1)$) -> (pq-p.i2);
  \signal[-|-] (pq-p.o1) -> ($(pq-p.o1)+(1,0)$);
  \node[] at ($(p2-p.o1)!.5!(pq-p.i1)$) {$\ddots$};

  \node[anchor=north east] at (vsq) {$\vect{s}^n$};
  \node[anchor=north east] at (vvq) {$\vect{v}^p$};
  \node[anchor=north east] at (sq) {$\vect{s}$};
\end{tikzpicture}
\end{lrbox}

\begin{tikzpicture}[nomoccolor, type style = \scriptsize\texttt]
  \node[anchor=east] (f) at (0,0) {\usebox{\formula}};
  \node[anchor=west] (n) at (2,0) {\usebox{\network}};
  \node[anchor=west]     at (1,0) {$\equiv$};
\end{tikzpicture}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
