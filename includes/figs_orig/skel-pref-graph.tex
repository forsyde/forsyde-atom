\documentclass{standalone}
\usepackage{forsyde-pc}
\usepackage{forsyde-math}
\begin{document}

\newsavebox\formula
\begin{lrbox}{\formula}
\begin{tikzpicture}[nomoccolor, type style = \scriptsize\texttt]
  \primitive[f=$p$]{pr}{0,2}{$\redS$};
  \primitive[f={}] {pm}{0,0}{$\fMapS$};
  \patternnodestd[ni=1, no=1, outer shape=transition shape v1gv1, type=inits]{init}{-2,0};
  \draw[dashed] (-1,1) rectangle (1,3); 
  
  \node[anchor=east] (s)  at ($(pr)-(1,0)$) {$\lambda\ \vect{s}$};
  \node[anchor=east] (vm) at ($(pm)-(3,0)$) {$\vect{s}$};

  \vector[token=scalar] (s) -> (pr); \signal[] (pr) -> (1,2);
  \function[] (0,1) -> (pm-f.i1);
  \vector[token=scalar] (vm) -> (init);
  \vector[token=vector] (init) -> (pm);
  \vector[token=scalar] (pm) -> (2,0);
\end{tikzpicture}
\end{lrbox}

\newsavebox\network
\begin{lrbox}{\network}
\begin{tikzpicture}[nomoccolor, type style = \scriptsize\texttt]
  \foreach \i/\y in {1/4, 2/2.5, q/0} {
    \leafstd[type=p, ni=2, nf=0 ,inner sep=8pt] {p\i} {-\y,\y} {$p_\i$};
    \coordinate (s\i) at ($(p\i -p.i2)-(5,0)+(\y,0)$);
    \coordinate (s2\i) at ($(p\i -p.i1)-(5,0)+(\y,0)$);
    \coordinate (o\i) at ($(p\i -p.o1)+(1,0)+(\y,0)$);
    \signal[] (s\i) -> (p\i -p.i2);
    \signal[] (p\i -p.o1) -> (o\i);
  }
  \vector[] (s21) - (sq);
  \vector[] (o1) - (oq);

  \signal[] (s21) -> (p1-p.i1);
  \signal[-|-] (p1-p.o1) -> (p2-p.i1);
  \signal[-|-] (p2-p.o1) -> ($(p2-p.o1)!.3!(pq-p.i1)$);
  \signal[-|-] ($(p2-p.o1)!.7!(pq-p.i1)$) -> (pq-p.i1);
  \node[] at ($(p2-p.o1)!.5!(pq-p.i1)$) {$\ddots$};

  \node[anchor=north east] at (sq) {$\vect{s_i}$};
  \node[anchor=north west] at (oq) {$\vect{s_o}$};
\end{tikzpicture}
\end{lrbox}

\begin{tikzpicture}[nomoccolor, type style = \scriptsize\texttt]
  \node[anchor=east] (f) at (0,0) {\usebox{\formula}};
  \node[anchor=west] (n) at (2,0) {\usebox{\network}};
  \node[anchor=west]     at (1,0) {$\equiv$};
\end{tikzpicture}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
